<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Java on PythonicğŸ¶</title>
    <link>http://danigong.github.io/tags/java/</link>
    <description>Recent content in Java on PythonicğŸ¶</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-CN</language>
    <lastBuildDate>Sat, 17 Mar 2018 16:59:13 +0800</lastBuildDate>
    <atom:link href="http://danigong.github.io/tags/java/feed/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Java Thread Dump</title>
      <link>http://danigong.github.io/post/java_thread_dump/</link>
      <pubDate>Sat, 17 Mar 2018 16:59:13 +0800</pubDate>
      
      <guid>http://danigong.github.io/post/java_thread_dump/</guid>
      <description>&lt;p&gt;è½¬è½½è‡ªï¼š&lt;a href=&#34;http://blog.csdn.net/rachel_luo/article/details/8920596&#34;&gt;http://blog.csdn.net/rachel_luo/article/details/8920596&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸€ã€Thread Dumpä»‹ç»&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1.1ä»€ä¹ˆæ˜¯Thread Dumpï¼Ÿ&lt;/p&gt;

&lt;p&gt;Thread Dumpæ˜¯éå¸¸æœ‰ç”¨çš„è¯Šæ–­Javaåº”ç”¨é—®é¢˜çš„å·¥å…·ã€‚æ¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºéƒ½æœ‰åŠæ—¶ç”Ÿæˆæ‰€æœ‰çº¿ç¨‹åœ¨æŸä¸€ç‚¹çŠ¶æ€çš„thread-dumpçš„èƒ½åŠ›ï¼Œè™½ç„¶å„ä¸ª Javaè™šæ‹Ÿæœºæ‰“å°çš„thread dumpç•¥æœ‰ä¸åŒï¼Œä½†æ˜¯å¤§å¤šéƒ½æä¾›äº†å½“å‰æ´»åŠ¨çº¿ç¨‹çš„å¿«ç…§ï¼ŒåŠJVMä¸­æ‰€æœ‰Javaçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œå †æ ˆä¿¡æ¯ä¸€èˆ¬åŒ…å«å®Œæ•´çš„ç±»ååŠæ‰€æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¦‚æœå¯èƒ½çš„è¯è¿˜æœ‰æºä»£ç çš„è¡Œæ•°ã€‚&lt;/p&gt;

&lt;p&gt;1.2 Thread Dumpç‰¹ç‚¹&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;èƒ½åœ¨å„ç§æ“ä½œç³»ç»Ÿä¸‹ä½¿ç”¨&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;èƒ½åœ¨å„ç§Javaåº”ç”¨æœåŠ¡å™¨ä¸‹ä½¿ç”¨&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è€Œä¸å½±å“ç³»ç»Ÿçš„æ€§èƒ½&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯ä»¥å°†é—®é¢˜ç›´æ¥å®šä½åˆ°åº”ç”¨ç¨‹åºçš„ä»£ç è¡Œä¸Š&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;1.3 Thread Dump èƒ½è¯Šæ–­çš„é—®é¢˜&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;æŸ¥æ‰¾å†…å­˜æ³„éœ²ï¼Œå¸¸è§çš„æ˜¯ç¨‹åºé‡Œloadå¤§é‡çš„æ•°æ®åˆ°ç¼“å­˜ï¼›&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å‘ç°æ­»é”çº¿ç¨‹ï¼›&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;1.4å¦‚ä½•æŠ“å–Thread Dump&lt;/p&gt;

&lt;p&gt;ä¸€èˆ¬å½“æœåŠ¡å™¨æŒ‚èµ·,å´©æºƒæˆ–è€…æ€§èƒ½åº•ä¸‹æ—¶,å°±éœ€è¦æŠ“å–æœåŠ¡å™¨çš„çº¿ç¨‹å †æ ˆ(Thread Dump)ç”¨äºåç»­çš„åˆ†æ. åœ¨å®é™…è¿è¡Œä¸­ï¼Œå¾€å¾€ä¸€æ¬¡ dumpçš„ä¿¡æ¯ï¼Œè¿˜ä¸è¶³ä»¥ç¡®è®¤é—®é¢˜ã€‚ä¸ºäº†åæ˜ çº¿ç¨‹çŠ¶æ€çš„åŠ¨æ€å˜åŒ–ï¼Œéœ€è¦æ¥è¿å¤šæ¬¡åšthreaddumpï¼Œæ¯æ¬¡é—´éš”10-20sï¼Œå»ºè®®è‡³å°‘äº§ç”Ÿä¸‰æ¬¡ dumpä¿¡æ¯ï¼Œå¦‚æœæ¯æ¬¡ dumpéƒ½æŒ‡å‘åŒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ‰ç¡®å®šé—®é¢˜çš„å…¸å‹æ€§ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰å¾ˆå¤šæ–¹å¼å¯ç”¨äºè·å–ThreadDump, ä¸‹é¢åˆ—å‡ºä¸€éƒ¨åˆ†è·å–æ–¹å¼ï¼š&lt;/p&gt;

&lt;p&gt;æ“ä½œç³»ç»Ÿå‘½ä»¤è·å–ThreadDump:&lt;/p&gt;

&lt;p&gt;Windows:&lt;/p&gt;

&lt;p&gt;1.è½¬å‘æœåŠ¡å™¨çš„æ ‡å‡†è¾“å‡ºçª—å£å¹¶æŒ‰ä¸‹Control + Breakç»„åˆé”®, ä¹‹åéœ€è¦å°†çº¿ç¨‹å †æ ˆå¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼›&lt;/p&gt;

&lt;p&gt;UNIX/ Linuxï¼š&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæŸ¥æ‰¾åˆ°æœåŠ¡å™¨çš„è¿›ç¨‹å·(process id), ç„¶åè·å–çº¿ç¨‹å †æ ˆ.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ps â€“ef  | grep java&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;kill -3 &lt;pid&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ³¨æ„ï¼šä¸€å®šè¦è°¨æ…, ä¸€æ­¥ä¸æ…å°±å¯èƒ½è®©æœåŠ¡å™¨è¿›ç¨‹è¢«æ€æ­»ã€‚kill -9 å‘½ä»¤ä¼šæ€æ­»è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;JVM è‡ªå¸¦çš„å·¥å…·è·å–çº¿ç¨‹å †æ ˆ:&lt;/p&gt;

&lt;p&gt;JDKè‡ªå¸¦å‘½ä»¤è¡Œå·¥å…·è·å–PIDï¼Œå†è·å–ThreadDump:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;jps æˆ– ps â€“ef|grepjava (è·å–PID)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;jstack [-l ]&lt;pid&gt; | tee -a jstack.log  (è·å–ThreadDump)&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;äºŒã€javaçº¿ç¨‹çš„çŠ¶æ€è½¬æ¢ä»‹ç»(ä¸ºåç»­åˆ†æåšå‡†å¤‡)&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;2.1 æ–°å»ºçŠ¶æ€ï¼ˆNewï¼‰&lt;/p&gt;

&lt;p&gt;ç”¨newè¯­å¥åˆ›å»ºçš„çº¿ç¨‹å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶å®ƒå’Œå…¶ä»–Javaå¯¹è±¡ä¸€æ ·ï¼Œä»…ä»…åœ¨å †åŒºä¸­è¢«åˆ†é…äº†å†…å­˜ã€‚&lt;/p&gt;

&lt;p&gt;2.2 å°±ç»ªçŠ¶æ€ï¼ˆRunnableï¼‰&lt;/p&gt;

&lt;p&gt;å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨å®ƒçš„start()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥å°±ç»ªçŠ¶æ€ï¼ŒJavaè™šæ‹Ÿæœºä¼šä¸ºå®ƒåˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œæ± ä¸­ï¼Œç­‰å¾…è·å¾—CPUçš„ä½¿ç”¨æƒã€‚&lt;/p&gt;

&lt;p&gt;2.3 è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰&lt;/p&gt;

&lt;p&gt;å¤„äºè¿™ä¸ªçŠ¶æ€çš„çº¿ç¨‹å ç”¨CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚åªæœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;2.4 é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰&lt;/p&gt;

&lt;p&gt;é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸäº›åŸå› æ”¾å¼ƒCPUï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚å½“çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¸ä¼šç»™çº¿ç¨‹åˆ†é…CPUã€‚ç›´åˆ°çº¿ç¨‹é‡æ–°è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå®ƒæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;é˜»å¡çŠ¶æ€å¯åˆ†ä¸ºä»¥ä¸‹3ç§ï¼š&lt;/p&gt;

&lt;p&gt;1ï¼‰ä½äºå¯¹è±¡ç­‰å¾…æ± ä¸­çš„é˜»å¡çŠ¶æ€ï¼ˆBlocked in objectâ€™s wait poolï¼‰ï¼šå½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œå¦‚æœæ‰§è¡Œäº†æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠçº¿ç¨‹æ”¾åˆ°è¿™ä¸ªå¯¹è±¡çš„ç­‰å¾…æ± ä¸­ï¼Œè¿™æ¶‰åŠåˆ°â€œçº¿ç¨‹é€šä¿¡â€çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;2ï¼‰ä½äºå¯¹è±¡é”æ± ä¸­çš„é˜»å¡çŠ¶æ€ï¼ˆBlocked in objectâ€™s lock poolï¼‰ï¼šå½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè¯•å›¾è·å¾—æŸä¸ªå¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡çš„åŒæ­¥é”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹æ”¾åˆ°è¿™ä¸ªå¯¹è±¡çš„é”æ± ä¸­ï¼Œè¿™æ¶‰åŠåˆ°â€œçº¿ç¨‹åŒæ­¥â€çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;3ï¼‰å…¶ä»–é˜»å¡çŠ¶æ€ï¼ˆOtherwise Blockedï¼‰ï¼šå½“å‰çº¿ç¨‹æ‰§è¡Œäº†sleep()æ–¹æ³•ï¼Œæˆ–è€…è°ƒç”¨äº†å…¶ä»–çº¿ç¨‹çš„join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼Œå°±ä¼šè¿›å…¥è¿™ä¸ªçŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;2.5 æ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰&lt;/p&gt;

&lt;p&gt;å½“çº¿ç¨‹é€€å‡ºrun()æ–¹æ³•æ—¶ï¼Œå°±è¿›å…¥æ­»äº¡çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸‰ã€Thread Dumpåˆ†æ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡å‰é¢1.4éƒ¨åˆ†çš„æ–¹æ³•ï¼Œè·å–Thread Dumpä¿¡æ¯åï¼Œå¯¹å…¶è¿›è¡Œåˆ†æï¼›&lt;/p&gt;

&lt;p&gt;3.1 é¦–å…ˆä»‹ç»ä¸€ä¸‹Thread Dumpä¿¡æ¯çš„å„ä¸ªéƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;å¤´éƒ¨ä¿¡æ¯ï¼š&lt;/p&gt;

&lt;p&gt;æ—¶é—´ï¼Œjvmä¿¡æ¯&lt;/p&gt;

&lt;p&gt;2011-11-02 19:05:06&lt;/p&gt;

&lt;p&gt;Full thread dump Java HotSpot&amp;trade; Server VM (16.3-b01 mixed mode):&lt;/p&gt;

&lt;p&gt;çº¿ç¨‹infoä¿¡æ¯å—ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&amp;ldquo;Timer-0&amp;rdquo; daemon prio=10tid=0xac190c00 nid=0xaef in Object.wait() [0xae77d000]&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;java.lang.Thread.State: TIMED_WAITING (on object monitor)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;atjava.lang.Object.wait(Native Method)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;-waiting on &lt;0xb3885f60&gt; (a java.util.TaskQueue)     ###ç»§ç»­wait&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;atjava.util.TimerThread.mainLoop(Timer.java:509)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;-locked &lt;0xb3885f60&gt; (a java.util.TaskQueue)         ###å·²ç»locked&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;atjava.util.TimerThread.run(Timer.java:462)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;çº¿ç¨‹åç§°ï¼šTimer-0&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;çº¿ç¨‹ç±»å‹ï¼šdaemon&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¼˜å…ˆçº§: 10ï¼Œé»˜è®¤æ˜¯5&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;jvmçº¿ç¨‹idï¼štid=0xac190c00ï¼Œjvmå†…éƒ¨çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼ˆé€šè¿‡java.lang.Thread.getId()è·å–ï¼Œé€šå¸¸ç”¨è‡ªå¢æ–¹å¼å®ç°ã€‚ï¼‰&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯¹åº”ç³»ç»Ÿçº¿ç¨‹idï¼ˆNativeThread IDï¼‰ï¼šnid=0xaefï¼Œå’Œtopå‘½ä»¤æŸ¥çœ‹çš„çº¿ç¨‹pidå¯¹åº”ï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯10è¿›åˆ¶ï¼Œä¸€ä¸ªæ˜¯16è¿›åˆ¶ã€‚ï¼ˆé€šè¿‡å‘½ä»¤ï¼štop -H -p pidï¼Œå¯ä»¥æŸ¥çœ‹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ä¿¡æ¯ï¼‰&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;çº¿ç¨‹çŠ¶æ€ï¼šin Object.wait().&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;èµ·å§‹æ ˆåœ°å€ï¼š[0xae77d000]&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Java thread statck traceï¼šæ˜¯ä¸Šé¢2-7è¡Œçš„ä¿¡æ¯ã€‚åˆ°ç›®å‰ä¸ºæ­¢è¿™æ˜¯æœ€é‡è¦çš„æ•°æ®ï¼ŒJava stack traceæä¾›äº†å¤§éƒ¨åˆ†ä¿¡æ¯æ¥ç²¾ç¡®å®šä½é—®é¢˜æ ¹æºã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¯¹äºthread dumpä¿¡æ¯ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯çº¿ç¨‹çš„çŠ¶æ€å’Œå…¶æ‰§è¡Œå †æ ˆã€‚ç°åœ¨é’ˆå¯¹è¿™ä¸¤ä¸ªé‡ç‚¹éƒ¨åˆ†è¿›è¡Œè®²è§£ï¼š&lt;/p&gt;

&lt;p&gt;1ï¼‰Java thread statck traceè¯¦è§£ï¼š&lt;/p&gt;

&lt;p&gt;å †æ ˆä¿¡æ¯åº”è¯¥é€†å‘è§£è¯»ï¼šç¨‹åºå…ˆæ‰§è¡Œçš„æ˜¯ç¬¬7è¡Œï¼Œç„¶åæ˜¯ç¬¬6è¡Œï¼Œä¾æ¬¡ç±»æ¨ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;locked &lt;0xb3885f60&gt; (a java.util.ArrayList)&lt;/li&gt;
&lt;li&gt;waiting on &lt;0xb3885f60&gt; (a java.util.ArrayList)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¯¹è±¡å…ˆä¸Šé”ï¼Œé”ä½å¯¹è±¡0xb3885f60ï¼Œç„¶åé‡Šæ”¾è¯¥å¯¹è±¡é”ï¼Œè¿›å…¥waitingçŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºå•¥ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿçœ‹çœ‹ä¸‹é¢çš„javaä»£ç ç¤ºä¾‹ï¼Œå°±ä¼šæ˜ç™½ï¼š&lt;/p&gt;

&lt;p&gt;synchronized(obj) {&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;   .........  

   obj.wait();  

   .........  
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;åœ¨å †æ ˆçš„ç¬¬ä¸€è¡Œä¿¡æ¯ä¸­ï¼Œè¿›ä¸€æ­¥æ ‡æ˜äº†çº¿ç¨‹åœ¨ä»£ç çº§çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;

&lt;p&gt;java.lang.Thread.State: TIMED_WAITING (parking)&lt;/p&gt;

&lt;p&gt;è§£é‡Šå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;|blocked|&lt;/p&gt;

&lt;p&gt;This thread tried to enter asynchronized block, but the lock was taken by another thread. This thread isblocked until the lock gets released.&lt;/p&gt;

&lt;p&gt;|blocked (on thin lock)|&lt;/p&gt;

&lt;p&gt;This is the same state asblocked, but the lock in question is a thin lock.&lt;/p&gt;

&lt;p&gt;|waiting|&lt;/p&gt;

&lt;p&gt;This thread calledObject.wait() on an object. The thread will remain there until some otherthread sends a notification to that object.&lt;/p&gt;

&lt;p&gt;|sleeping|&lt;/p&gt;

&lt;p&gt;This thread calledjava.lang.Thread.sleep().&lt;/p&gt;

&lt;p&gt;|parked|&lt;/p&gt;

&lt;p&gt;This thread calledjava.util.concurrent.locks.LockSupport.park().&lt;/p&gt;

&lt;p&gt;|suspended|&lt;/p&gt;

&lt;p&gt;The thread&amp;rsquo;s execution wassuspended by java.lang.Thread.suspend() or a JVMTI agent call.&lt;/p&gt;

&lt;p&gt;2) çº¿ç¨‹çŠ¶æ€è¯¦è§£ï¼š&lt;/p&gt;

&lt;p&gt;Runnable
&lt;em&gt;The thread is either running or ready to run when it gets its CPU turn.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Wait on condition
&lt;em&gt;The thread is either sleeping or waiting to be notified by another thread.&lt;/em&gt;
    è¯¥çŠ¶æ€å‡ºç°åœ¨çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿæˆ–è€…sleepã€‚å…·ä½“æ˜¯ä»€ä¹ˆåŸå› ï¼Œå¯ä»¥ç»“åˆ stacktraceæ¥åˆ†æã€‚æœ€å¸¸è§çš„æƒ…å†µæ˜¯çº¿ç¨‹åœ¨ç­‰å¾…ç½‘ç»œçš„è¯»å†™ï¼Œæ¯”å¦‚å½“ç½‘ç»œæ•°æ®æ²¡æœ‰å‡†å¤‡å¥½è¯»æ—¶ï¼Œçº¿ç¨‹å¤„äºè¿™ç§ç­‰å¾…çŠ¶æ€ï¼Œè€Œä¸€æ—¦æœ‰æ•°æ®å‡†å¤‡å¥½è¯»ä¹‹åï¼Œçº¿ç¨‹ä¼šé‡æ–°æ¿€æ´»ï¼Œè¯»å–å¹¶å¤„ç†æ•°æ®ã€‚åœ¨Javaå¼•å…¥ New IOä¹‹å‰ï¼Œå¯¹äºæ¯ä¸ªç½‘ç»œè¿æ¥ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œçš„è¯»å†™æ“ä½œï¼Œå³ä½¿æ²¡æœ‰å¯è¯»å†™çš„æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶é˜»å¡åœ¨è¯»å†™æ“ä½œä¸Šï¼Œè¿™æ ·æœ‰å¯èƒ½é€ æˆèµ„æºæµªè´¹ï¼Œè€Œä¸”ç»™æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ä¹Ÿå¸¦æ¥å‹åŠ›ã€‚åœ¨ New IOé‡Œé‡‡ç”¨äº†æ–°çš„æœºåˆ¶ï¼Œç¼–å†™çš„æœåŠ¡å™¨ç¨‹åºçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§éƒ½å¾—åˆ°æé«˜ã€‚
    å¦‚æœå‘ç°æœ‰å¤§é‡çš„çº¿ç¨‹éƒ½å¤„åœ¨ Wait on conditionï¼Œä»çº¿ç¨‹ stackçœ‹ï¼Œ æ­£ç­‰å¾…ç½‘ç»œè¯»å†™ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç“¶é¢ˆçš„å¾å…†ã€‚å› ä¸ºç½‘ç»œé˜»å¡å¯¼è‡´çº¿ç¨‹æ— æ³•æ‰§è¡Œã€‚ä¸€ç§æƒ…å†µæ˜¯ç½‘ç»œéå¸¸å¿™ï¼Œå‡ ä¹æ¶ˆè€—äº†æ‰€æœ‰çš„å¸¦å®½ï¼Œä»ç„¶æœ‰å¤§é‡æ•°æ®ç­‰å¾…ç½‘ç»œè¯»å†™ï¼›å¦ä¸€ç§æƒ…å†µä¹Ÿå¯èƒ½æ˜¯ç½‘ç»œç©ºé—²ï¼Œä½†ç”±äºè·¯ç”±ç­‰é—®é¢˜ï¼Œå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸çš„åˆ°è¾¾ã€‚æ‰€ä»¥è¦ç»“åˆç³»ç»Ÿçš„ä¸€äº›æ€§èƒ½è§‚å¯Ÿå·¥å…·æ¥ç»¼åˆåˆ†æï¼Œæ¯”å¦‚ netstatç»Ÿè®¡å•ä½æ—¶é—´çš„å‘é€åŒ…çš„æ•°ç›®ï¼Œçœ‹æ˜¯å¦å¾ˆæ˜æ˜¾è¶…è¿‡äº†æ‰€åœ¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶ï¼›è§‚å¯Ÿcpuçš„åˆ©ç”¨ç‡ï¼Œçœ‹ç³»ç»Ÿæ€çš„CPUæ—¶é—´æ˜¯å¦æ˜æ˜¾å¤§äºç”¨æˆ·æ€çš„CPUæ—¶é—´ï¼›å¦‚æœç¨‹åºè¿è¡Œåœ¨ Solaris 10å¹³å°ä¸Šï¼Œå¯ä»¥ç”¨dtraceå·¥å…·çœ‹ç³»ç»Ÿè°ƒç”¨çš„æƒ…å†µï¼Œå¦‚æœè§‚å¯Ÿåˆ° read/writeçš„ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°æˆ–è€…è¿è¡Œæ—¶é—´é¥é¥é¢†å…ˆï¼›è¿™äº›éƒ½æŒ‡å‘ç”±äºç½‘ç»œå¸¦å®½æ‰€é™å¯¼è‡´çš„ç½‘ç»œç“¶é¢ˆã€‚å¦å¤–ä¸€ç§å‡ºç° Wait on conditionçš„å¸¸è§æƒ…å†µæ˜¯è¯¥çº¿ç¨‹åœ¨ sleepï¼Œç­‰å¾… sleepçš„æ—¶é—´åˆ°äº†ï¼Œå°†è¢«å”¤é†’ã€‚&lt;/p&gt;

&lt;p&gt;Waiting for Monitor Entry and in Object.wait()&lt;/p&gt;

&lt;p&gt;&lt;em&gt;The thread is waiting to getthe lock for an object (some other thread may be holding the lock). Thishappens if two or more threads try to execute synchronized code. Note that thelock is always for an object and not for individual methods.&lt;/em&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;åœ¨å¤šçº¿ç¨‹çš„ JAVAç¨‹åºä¸­ï¼Œå®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼Œå°±è¦è¯´è¯´ Monitorã€‚ Monitoræ˜¯Javaä¸­ç”¨ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸åä½œçš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯å¯¹è±¡æˆ–è€… Classçš„é”ã€‚æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ï¼Œä¹Ÿä»…æœ‰ä¸€ä¸ª monitorã€‚æ¯ä¸ª Monitoråœ¨æŸä¸ªæ—¶åˆ»ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ â€œActiveThreadâ€ï¼Œè€Œå…¶å®ƒçº¿ç¨‹éƒ½æ˜¯ â€œWaiting Threadâ€ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªé˜Ÿåˆ— â€œ Entry Setâ€å’Œ â€œWait Setâ€é‡Œé¢ç­‰å€™ã€‚åœ¨ â€œEntry Setâ€ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ â€œWaiting for monitorentryâ€ï¼Œè€Œåœ¨ â€œWait Setâ€ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯â€œin Object.wait()â€ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å…ˆçœ‹ â€œEntry Setâ€é‡Œé¢çš„çº¿ç¨‹ã€‚æˆ‘ä»¬ç§°è¢« synchronizedä¿æŠ¤èµ·æ¥çš„ä»£ç æ®µä¸ºä¸´ç•ŒåŒºã€‚å½“ä¸€ä¸ªçº¿ç¨‹ç”³è¯·è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒå°±è¿›å…¥äº† â€œEntry Setâ€é˜Ÿåˆ—ã€‚å¯¹åº”çš„ codeå°±åƒï¼š
synchronized(obj) {
    &amp;hellip;&amp;hellip;&amp;hellip;
}
è¿™æ—¶æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š
    è¯¥ monitorä¸è¢«å…¶å®ƒçº¿ç¨‹æ‹¥æœ‰ï¼Œ Entry Seté‡Œé¢ä¹Ÿæ²¡æœ‰å…¶å®ƒç­‰å¾…çº¿ç¨‹ã€‚æœ¬çº¿ç¨‹å³æˆä¸ºç›¸åº”ç±»æˆ–è€…å¯¹è±¡çš„ Monitorçš„ Ownerï¼Œæ‰§è¡Œä¸´ç•ŒåŒºçš„ä»£ç ã€‚
    è¯¥ monitorè¢«å…¶å®ƒçº¿ç¨‹æ‹¥æœ‰ï¼Œæœ¬çº¿ç¨‹åœ¨ Entry Seté˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚
    åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œçº¿ç¨‹å°†å¤„äº â€œRunnableâ€çš„çŠ¶æ€ï¼Œè€Œç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ DUMPä¼šæ˜¾ç¤ºå¤„äº â€œwaiting for monitor entryâ€ã€‚&lt;/p&gt;

&lt;p&gt;ä¸´ç•ŒåŒºçš„è®¾ç½®ï¼Œæ˜¯ä¸ºäº†ä¿è¯å…¶å†…éƒ¨çš„ä»£ç æ‰§è¡Œçš„åŸå­æ€§å’Œå®Œæ•´æ€§ã€‚ä½†æ˜¯å› ä¸ºä¸´ç•ŒåŒºåœ¨ä»»ä½•æ—¶é—´åªå…è®¸çº¿ç¨‹ä¸²è¡Œé€šè¿‡ï¼Œè¿™å’Œæˆ‘ä»¬å¤šçº¿ç¨‹çš„ç¨‹åºçš„åˆè¡·æ˜¯ç›¸åçš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹çš„ç¨‹åºä¸­ï¼Œå¤§é‡ä½¿ç”¨ synchronizedï¼Œæˆ–è€…ä¸é€‚å½“çš„ä½¿ç”¨äº†å®ƒï¼Œä¼šé€ æˆå¤§é‡çº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„å…¥å£ç­‰å¾…ï¼Œé€ æˆç³»ç»Ÿçš„æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å¦‚æœåœ¨çº¿ç¨‹ DUMPä¸­å‘ç°äº†è¿™ä¸ªæƒ…å†µï¼Œåº”è¯¥å®¡æŸ¥æºç ï¼Œæ”¹è¿›ç¨‹åºã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;å†çœ‹â€œWait Setâ€é‡Œé¢çš„çº¿ç¨‹ã€‚å½“çº¿ç¨‹è·å¾—äº† Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åï¼Œå¦‚æœå‘ç°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆä¸€èˆ¬å°±æ˜¯è¢« synchronized çš„å¯¹è±¡ï¼‰çš„ wait() æ–¹æ³•ï¼Œæ”¾å¼ƒ Monitorï¼Œè¿›å…¥ â€œWait Setâ€é˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify() æˆ–è€… notifyAll()ï¼Œâ€œWait Setâ€é˜Ÿåˆ—ä¸­çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šå»ç«äº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚åœ¨ â€œWait Setâ€ä¸­çš„çº¿ç¨‹ï¼Œ DUMPä¸­è¡¨ç°ä¸ºï¼š in Object.wait()ã€‚
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸€èˆ¬ï¼ŒCpuå¾ˆå¿™æ—¶ï¼Œåˆ™å…³æ³¨runnableçš„çº¿ç¨‹ï¼ŒCpuå¾ˆé—²æ—¶ï¼Œåˆ™å…³æ³¨waiting for monitor entryçš„çº¿ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;3.2 JVMçº¿ç¨‹ä»‹ç»&lt;/p&gt;

&lt;p&gt;åœ¨Thread Dumpä¸­ï¼Œæœ‰ä¸€äº› JVMå†…éƒ¨çš„åå°çº¿ç¨‹ï¼Œæ¥æ‰§è¡Œè­¬å¦‚åƒåœ¾å›æ”¶ï¼Œæˆ–è€…ä½å†…å­˜çš„æ£€æµ‹ç­‰ç­‰ä»»åŠ¡ï¼Œè¿™äº›çº¿ç¨‹å¾€å¾€åœ¨ JVMåˆå§‹åŒ–çš„æ—¶å€™å°±å­˜åœ¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;HotSpot VM Thread&lt;/p&gt;

&lt;p&gt;è¢«HotSpot VMç®¡ç†çš„å†…éƒ¨çº¿ç¨‹ä¸ºäº†å®Œæˆå†…éƒ¨æœ¬åœ°æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ä¸éœ€è¦æ‹…å¿ƒå®ƒä»¬ï¼Œé™¤éCPUå¾ˆé«˜ã€‚&lt;/p&gt;

&lt;p&gt;&amp;ldquo;VM Periodic Task Thread&amp;rdquo; prio=10tid=0xad909400 nid=0xaed waiting on condition&lt;/p&gt;

&lt;p&gt;HotSpot GC Thread&lt;/p&gt;

&lt;p&gt;å½“ä½¿ç”¨HotSpot parallel GCï¼ŒHotSpot VMé»˜è®¤åˆ›å»ºä¸€å®šæ•°ç›®çš„GC threadã€‚&lt;/p&gt;

&lt;p&gt;&amp;ldquo;GC task thread#0 (ParallelGC)&amp;ldquo;prio=10 tid=0xf690b400 nid=0xade runnable&lt;/p&gt;

&lt;p&gt;&amp;ldquo;GC task thread#1 (ParallelGC)&amp;ldquo;prio=10 tid=0xf690cc00 nid=0xadf runnable&lt;/p&gt;

&lt;p&gt;&amp;ldquo;GC task thread#2 (ParallelGC)&amp;ldquo;prio=10 tid=0xf690e000 nid=0xae0 runnable&lt;/p&gt;

&lt;p&gt;â€¦â€¦&lt;/p&gt;

&lt;p&gt;å½“é¢å¯¹è¿‡å¤šGCï¼Œå†…å­˜æ³„éœ²ç­‰é—®é¢˜æ—¶ï¼Œè¿™äº›æ˜¯å…³é”®çš„æ•°æ®ã€‚ä½¿ç”¨native idï¼Œå¯ä»¥å°†ä»OS/Javaè¿›ç¨‹è§‚æµ‹åˆ°çš„é«˜CPUä¸è¿™äº›çº¿ç¨‹å…³è”èµ·æ¥ã€‚&lt;/p&gt;

&lt;p&gt;JNI global references count&lt;/p&gt;

&lt;p&gt;JNI global referenceæ˜¯åŸºæœ¬çš„å¯¹è±¡å¼•ç”¨ï¼Œä»æœ¬åœ°ä»£ç åˆ°è¢«Java GCç®¡ç†çš„Javaå¯¹è±¡çš„å¼•ç”¨ã€‚å…¶è§’è‰²æ˜¯é˜»æ­¢ä»ç„¶è¢«æœ¬åœ°ä»£ç ä½¿ç”¨çš„å¯¹è±¡é›†åˆï¼Œä½†åœ¨Javaä»£ç ä¸­æ²¡æœ‰å¼•ç”¨ã€‚åœ¨æ¢æµ‹JNIç›¸å…³å†…å­˜æ³„éœ²æ—¶ï¼Œå…³æ³¨JNI referenceså¾ˆé‡è¦ã€‚å¦‚æœä½ çš„ç¨‹åºç›´æ¥ä½¿ç”¨JNIæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚æ£€æµ‹å·¥å…·ï¼Œæ£€æµ‹æœ¬åœ°å†…å­˜æ³„éœ²ã€‚&lt;/p&gt;

&lt;p&gt;JNI global references: 832&lt;/p&gt;

&lt;p&gt;Java Heap utilization view&lt;/p&gt;

&lt;p&gt;ä»jdk1.6å¼€å§‹åœ¨thread dumpå¿«ç…§åº•éƒ¨ï¼Œå¯ä»¥æ‰¾åˆ°å´©æºƒç‚¹çš„å†…å­˜ç©ºé—´åˆ©ç”¨æƒ…å†µ:YongGen,OldGenå’ŒPermGenã€‚ç›®å‰æˆ‘æµ‹è¯•çš„ç³»ç»Ÿå¯¼å‡ºçš„thread dumpï¼Œè¿˜æœªè§åˆ°è¿™ä¸€éƒ¨åˆ†å†…å®¹ï¼ˆsun jdk1.6ï¼‰ã€‚ä»¥ä¸‹ä¾‹å­ï¼Œæ‘˜è‡ªä»–äººæ–‡ç« ï¼š&lt;/p&gt;

&lt;p&gt;Heap&lt;/p&gt;

&lt;p&gt;PSYoungGen      total 466944K, used 178734K [0xffffffff45c00000, 0xffffffff70800000, 0xffffffff70800000)&lt;/p&gt;

&lt;p&gt;eden space 233472K, 76% used [0xffffffff45c00000,0xffffffff50ab7c50,0xffffffff54000000)&lt;/p&gt;

&lt;p&gt;from space 233472K, 0% used [0xffffffff62400000,0xffffffff62400000,0xffffffff70800000)&lt;/p&gt;

&lt;p&gt;to   space 233472K, 0% used [0xffffffff54000000,0xffffffff54000000,0xffffffff62400000)&lt;/p&gt;

&lt;p&gt;PSOldGen        total 1400832K, used 1400831K [0xfffffffef0400000, 0xffffffff45c00000, 0xffffffff45c00000)&lt;/p&gt;

&lt;p&gt;object space 1400832K, 99% used [0xfffffffef0400000,0xffffffff45bfffb8,0xffffffff45c00000)&lt;/p&gt;

&lt;p&gt;PSPermGen       total 262144K, used 248475K [0xfffffffed0400000, 0xfffffffee0400000, 0xfffffffef0400000)&lt;/p&gt;

&lt;p&gt;object space 262144K, 94% used [0xfffffffed0400000,0xfffffffedf6a6f08,0xfffffffee0400000)&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰ä¸€äº›å…¶ä»–çš„çº¿ç¨‹ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œä¸ä¸€ä¸€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£ï¼Œå¯æŸ¥çœ‹æ–‡ç« æœ€åçš„é™„ä»¶ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;&amp;ldquo;Low Memory Detector&amp;rdquo; daemon prio=10tid=0xad907400 nid=0xaec runnable [0x00000000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;CompilerThread1&amp;rdquo; daemon prio=10tid=0xad905400 nid=0xaeb waiting on condition [0x00000000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;CompilerThread0&amp;rdquo; daemon prio=10tid=0xad903c00 nid=0xaea waiting on condition [0x00000000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;Signal Dispatcher&amp;rdquo; daemon prio=10tid=0xad902400 nid=0xae9 runnable [0x00000000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;Finalizer&amp;rdquo; daemon prio=10tid=0xf69eec00 nid=0xae8 in Object.wait() [0xaf17d000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;Reference Handler&amp;rdquo; daemon prio=10tid=0xf69ed800 nid=0xae7 in Object.wait() [0xae1e7000]&lt;/p&gt;

&lt;p&gt;&amp;ldquo;VM Thread&amp;rdquo; prio=10 tid=0xf69e9800nid=0xae6 runnable&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å››ã€æ¡ˆä¾‹åˆ†æï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;4.1ã€ä½¿ç”¨æ–¹æ¡ˆ&lt;/p&gt;

&lt;p&gt;cpué£™é«˜ï¼Œloadé«˜ï¼Œå“åº”å¾ˆæ…¢&lt;/p&gt;

&lt;p&gt;æ–¹æ¡ˆï¼š
* ä¸€ä¸ªè¯·æ±‚è¿‡ç¨‹ä¸­å¤šæ¬¡dump&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¯¹æ¯”å¤šæ¬¡dumpæ–‡ä»¶çš„runnableçº¿ç¨‹ï¼Œå¦‚æœæ‰§è¡Œçš„æ–¹æ³•æœ‰æ¯”è¾ƒå¤§å˜åŒ–ï¼Œè¯´æ˜æ¯”è¾ƒæ­£å¸¸ã€‚å¦‚æœåœ¨æ‰§è¡ŒåŒä¸€ä¸ªæ–¹æ³•ï¼Œå°±æœ‰ä¸€äº›é—®é¢˜äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æŸ¥æ‰¾å ç”¨cpuæœ€å¤šçš„çº¿ç¨‹ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;æ–¹æ¡ˆï¼š
* ä½¿ç”¨å‘½ä»¤ï¼š top -H -p pidï¼ˆpidä¸ºè¢«æµ‹ç³»ç»Ÿçš„è¿›ç¨‹å·ï¼‰ï¼Œæ‰¾åˆ°å¯¼è‡´cpué«˜çš„çº¿ç¨‹idã€‚&lt;/p&gt;

&lt;p&gt;ä¸Šè¿°Topå‘½ä»¤æ‰¾åˆ°çš„çº¿ç¨‹idï¼Œå¯¹åº”ç€dump threadä¿¡æ¯ä¸­çº¿ç¨‹çš„nidï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯åè¿›åˆ¶ï¼Œä¸€ä¸ªæ˜¯åå…­è¿›åˆ¶ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨thread dumpä¸­ï¼Œæ ¹æ®topå‘½ä»¤æŸ¥æ‰¾çš„çº¿ç¨‹idï¼ŒæŸ¥æ‰¾å¯¹åº”çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;cpuä½¿ç”¨ç‡ä¸é«˜ä½†æ˜¯å“åº”å¾ˆæ…¢&lt;/p&gt;

&lt;p&gt;æ–¹æ¡ˆï¼š
* è¿›è¡Œdumpï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¾ˆå¤šthread struckåœ¨äº†i/oã€æ•°æ®åº“ç­‰åœ°æ–¹ï¼Œå®šä½ç“¶é¢ˆåŸå› ã€‚&lt;/p&gt;

&lt;p&gt;è¯·æ±‚æ— æ³•å“åº”&lt;/p&gt;

&lt;p&gt;æ–¹æ¡ˆï¼š
* å¤šæ¬¡dumpï¼Œå¯¹æ¯”æ˜¯å¦æ‰€æœ‰çš„runnableçº¿ç¨‹éƒ½ä¸€ç›´åœ¨æ‰§è¡Œç›¸åŒçš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯çš„ï¼Œæ­å–œä½ ï¼Œé”ä½äº†ï¼&lt;/p&gt;

&lt;p&gt;4.2 æ¡ˆä¾‹åˆ†æï¼š&lt;/p&gt;

&lt;p&gt;1.æ­»é”ï¼š&lt;/p&gt;

&lt;p&gt;æ­»é”ç»å¸¸è¡¨ç°ä¸ºç¨‹åºçš„åœé¡¿ï¼Œæˆ–è€…ä¸å†å“åº”ç”¨æˆ·çš„è¯·æ±‚ã€‚ä»æ“ä½œç³»ç»Ÿä¸Šè§‚å¯Ÿï¼Œå¯¹åº”è¿›ç¨‹çš„CPUå ç”¨ç‡ä¸ºé›¶ï¼Œå¾ˆå¿«ä¼šä»topæˆ–prstatçš„è¾“å‡ºä¸­æ¶ˆå¤±ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;åœ¨thread dumpä¸­ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼äºè¿™æ ·çš„ä¿¡æ¯ï¼š
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ï¼ˆå›¾ 1ï¼‰&lt;/p&gt;

&lt;p&gt;ï¼ˆå›¾2ï¼‰&lt;/p&gt;

&lt;p&gt;è¯´æ˜ï¼š&lt;/p&gt;

&lt;p&gt;ï¼ˆå›¾1ï¼‰ä¸­æœ‰ä¸€ä¸ªâ€œWaiting formonitor entryâ€ï¼Œå¯ä»¥çœ‹å‡ºï¼Œä¸¤ä¸ªçº¿ç¨‹å„æŒæœ‰ä¸€ä¸ªé”ï¼Œåˆåœ¨ç­‰å¾…å¦ä¸€ä¸ªé”ï¼Œå¾ˆæ˜æ˜¾è¿™ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹æ–¹æ­£åœ¨ç­‰å¾…çš„é”ã€‚æ‰€ä»¥é€ æˆäº†æ­»é”ç°è±¡ï¼›&lt;/p&gt;

&lt;p&gt;ï¼ˆå›¾2ï¼‰ä¸­å¯¹æ­»é”çš„ç°è±¡åšäº†è¯´æ˜ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯â€œDeadLockTest.javaâ€çš„39è¡Œé€ æˆçš„æ­»é”ç°è±¡ã€‚è¿™æ ·å°±èƒ½åˆ°ç›¸åº”çš„ä»£ç ä¸‹å»æŸ¥çœ‹ï¼Œå®šä½é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;2.çƒ­é”&lt;/p&gt;

&lt;p&gt;çƒ­é”ï¼Œä¹Ÿå¾€å¾€æ˜¯å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆçš„ä¸»è¦å› ç´ ã€‚å…¶è¡¨ç°ç‰¹å¾ä¸ºï¼šç”±äºå¤šä¸ªçº¿ç¨‹å¯¹ä¸´ç•ŒåŒºï¼Œæˆ–è€…é”çš„ç«äº‰ï¼Œå¯èƒ½å‡ºç°ï¼š
    * é¢‘ç¹çš„çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šä»æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹çš„è°ƒåº¦æ¥çœ‹ï¼Œå½“çº¿ç¨‹åœ¨ç­‰å¾…èµ„æºè€Œé˜»å¡çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ä¹‹åˆ‡æ¢å‡ºæ¥ï¼Œæ”¾åˆ°ç­‰å¾…çš„é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹è·å¾—èµ„æºä¹‹åï¼Œè°ƒåº¦ç®—æ³•ä¼šå°†è¿™ä¸ªçº¿ç¨‹åˆ‡æ¢è¿›å»ï¼Œæ”¾åˆ°æ‰§è¡Œé˜Ÿåˆ—ä¸­ã€‚
    * å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼šå› ä¸ºçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä»¥åŠçƒ­é”çš„ç«äº‰ï¼Œæˆ–è€…ä¸´ç•ŒåŒºçš„é¢‘ç¹çš„è¿›å‡ºï¼Œéƒ½å¯èƒ½å¯¼è‡´å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ã€‚
    * å¤§éƒ¨åˆ†CPUå¼€é”€ç”¨åœ¨â€œç³»ç»Ÿæ€ â€ï¼šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œç³»ç»Ÿè°ƒç”¨ï¼Œéƒ½ä¼šå¯¼è‡´ CPUåœ¨ â€œç³»ç»Ÿæ€ â€è¿è¡Œï¼Œæ¢è€Œè¨€ä¹‹ï¼Œè™½ç„¶ç³»ç»Ÿå¾ˆå¿™ç¢Œï¼Œä½†æ˜¯ CPUç”¨åœ¨ â€œç”¨æˆ·æ€ â€çš„æ¯”ä¾‹è¾ƒå°ï¼Œåº”ç”¨ç¨‹åºå¾—ä¸åˆ°å……åˆ†çš„ CPUèµ„æºã€‚
    * éšç€ CPUæ•°ç›®çš„å¢å¤šï¼Œç³»ç»Ÿçš„æ€§èƒ½åè€Œä¸‹é™ã€‚å› ä¸ºCPUæ•°ç›®å¤šï¼ŒåŒæ—¶è¿è¡Œçš„çº¿ç¨‹å°±è¶Šå¤šï¼Œå¯èƒ½å°±ä¼šé€ æˆæ›´é¢‘ç¹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç³»ç»Ÿæ€çš„CPUå¼€é”€ï¼Œä»è€Œå¯¼è‡´æ›´ç³Ÿç³•çš„æ€§èƒ½ã€‚
    ä¸Šé¢çš„æè¿°ï¼Œéƒ½æ˜¯ä¸€ä¸ª scalabilityï¼ˆå¯æ‰©å±•æ€§ï¼‰å¾ˆå·®çš„ç³»ç»Ÿçš„è¡¨ç°ã€‚ä»æ•´ä½“çš„æ€§èƒ½æŒ‡æ ‡çœ‹ï¼Œç”±äºçº¿ç¨‹çƒ­é”çš„å­˜åœ¨ï¼Œç¨‹åºçš„å“åº”æ—¶é—´ä¼šå˜é•¿ï¼Œååé‡ä¼šé™ä½ã€‚
    é‚£ä¹ˆï¼Œæ€ä¹ˆå»äº†è§£ â€œçƒ­é” â€å‡ºç°åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿä¸€ä¸ªé‡è¦çš„æ–¹æ³•è¿˜æ˜¯ç»“åˆæ“ä½œç³»ç»Ÿçš„å„ç§å·¥å…·è§‚å¯Ÿç³»ç»Ÿèµ„æºä½¿ç”¨çŠ¶å†µï¼Œä»¥åŠæ”¶é›†Javaçº¿ç¨‹çš„DUMPä¿¡æ¯ï¼Œçœ‹çº¿ç¨‹éƒ½é˜»å¡åœ¨ä»€ä¹ˆæ–¹æ³•ä¸Šï¼Œäº†è§£åŸå› ï¼Œæ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„è§£å†³æ–¹æ³•ã€‚
    æˆ‘ä»¬æ›¾ç»é‡åˆ°è¿‡è¿™æ ·çš„ä¾‹å­ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œå‡ºç°äº†ä»¥ä¸ŠæŒ‡å‡ºçš„å„ç§ç°è±¡ï¼Œé€šè¿‡è§‚å¯Ÿæ“ä½œç³»ç»Ÿçš„èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼Œä»¥åŠçº¿ç¨‹ DUMPä¿¡æ¯ï¼Œç¡®å®šäº†ç¨‹åºä¸­çƒ­é”çš„å­˜åœ¨ï¼Œå¹¶å‘ç°å¤§å¤šæ•°çš„çº¿ç¨‹çŠ¶æ€éƒ½æ˜¯ Waitingfor monitor entryæˆ–è€… Wait on monitorï¼Œä¸”æ˜¯é˜»å¡åœ¨å‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹æ³•ä¸Šã€‚åæ¥é‡‡ç”¨ç¬¬ä¸‰æ–¹çš„å‹ç¼©åŒ… javalibæ›¿ä»£ JDKè‡ªå¸¦çš„å‹ç¼©åŒ…åï¼Œç³»ç»Ÿçš„æ€§èƒ½æé«˜äº†å‡ å€ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;äº”ã€é™„ä»¶ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;JVMè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€äº›æ¯”è¾ƒé‡è¦çš„çº¿ç¨‹ç½—åˆ—å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;çº¿ç¨‹åç§°&lt;/p&gt;

&lt;p&gt;æ‰€å±&lt;/p&gt;

&lt;p&gt;è§£é‡Šè¯´æ˜&lt;/p&gt;

&lt;p&gt;Attach Listener&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;Attach Listener çº¿ç¨‹æ˜¯è´Ÿè´£æ¥æ”¶åˆ°å¤–éƒ¨çš„å‘½ä»¤ï¼Œè€Œå¯¹è¯¥å‘½ä»¤è¿›è¡Œæ‰§è¡Œçš„å¹¶ä¸”å§ç»“æœè¿”å›ç»™å‘é€è€…ã€‚é€šå¸¸æˆ‘ä»¬ä¼šç”¨ä¸€äº›å‘½ä»¤å»è¦æ±‚jvmç»™æˆ‘ä»¬ä¸€äº›åé¦ˆä¿¡æ¯ï¼Œå¦‚ï¼šjava -versionã€jmapã€jstackç­‰ç­‰ã€‚ å¦‚æœè¯¥çº¿ç¨‹åœ¨jvmå¯åŠ¨çš„æ—¶å€™æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£ä¹ˆï¼Œåˆ™ä¼šåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰§è¡Œjvmå‘½ä»¤æ—¶ï¼Œå¾—åˆ°å¯åŠ¨ã€‚&lt;/p&gt;

&lt;p&gt;Signal Dispatcher&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;å‰é¢æˆ‘ä»¬æåˆ°ç¬¬ä¸€ä¸ªAttach Listenerçº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™signal dispather çº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚ signal dispatherçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;CompilerThread0&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;ç”¨æ¥è°ƒç”¨JITingï¼Œå®æ—¶ç¼–è¯‘è£…å¸class ã€‚ é€šå¸¸ï¼Œjvmä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œä¾‹å¦‚ï¼šCompilerThread1&lt;/p&gt;

&lt;p&gt;Concurrent Mark-Sweep GC Thread&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;å¹¶å‘æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„CMS GCï¼‰çº¿ç¨‹ï¼Œ è¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºè€å¹´ä»£åƒåœ¾å›æ”¶ã€‚psï¼šå¯ç”¨è¯¥åƒåœ¾å›æ”¶å™¨ï¼Œéœ€è¦åœ¨jvmå¯åŠ¨å‚æ•°ä¸­åŠ ä¸Šï¼š -XX:+UseConcMarkSweepGC&lt;/p&gt;

&lt;p&gt;DestroyJavaVM&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œmain()çš„çº¿ç¨‹åœ¨mainæ‰§è¡Œå®Œåè°ƒç”¨JNIä¸­çš„ jni_DestroyJavaVM() æ–¹æ³•å”¤èµ·DestroyJavaVM çº¿ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;JVMåœ¨ Jboss æœåŠ¡å™¨å¯åŠ¨ä¹‹åï¼Œå°±ä¼šå”¤èµ·DestroyJavaVMçº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjavaçº¿ç¨‹å’Œnativeçº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½JVMã€‚çº¿ç¨‹é€€å‡ºæ—¶ï¼Œéƒ½ä¼šåˆ¤æ–­è‡ªå·±å½“å‰æ˜¯å¦æ˜¯æ•´ä¸ªJVMä¸­æœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™é€šçŸ¥DestroyJavaVM çº¿ç¨‹å¸è½½JVMã€‚&lt;/p&gt;

&lt;p&gt;psï¼š&lt;/p&gt;

&lt;p&gt;æ‰©å±•ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;1.å¦‚æœçº¿ç¨‹é€€å‡ºæ—¶åˆ¤æ–­è‡ªå·±ä¸ä¸ºæœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œé‚£ä¹ˆè°ƒç”¨thread-&amp;gt;exit(false) ï¼Œå¹¶åœ¨å…¶ä¸­æŠ›å‡ºthread_endäº‹ä»¶ï¼Œjvmä¸é€€å‡ºã€‚&lt;/p&gt;

&lt;p&gt;2.å¦‚æœçº¿ç¨‹é€€å‡ºæ—¶åˆ¤æ–­è‡ªå·±ä¸ºæœ€åä¸€ä¸ªédeamonçº¿ç¨‹ï¼Œé‚£ä¹ˆè°ƒç”¨before_exit() æ–¹æ³•ï¼ŒæŠ›å‡ºä¸¤ä¸ªäº‹ä»¶ï¼š&lt;/p&gt;

&lt;p&gt;äº‹ä»¶1ï¼šthread_end çº¿ç¨‹ç»“æŸäº‹ä»¶ï¼›&lt;/p&gt;

&lt;p&gt;äº‹ä»¶2ï¼šVMçš„deathäº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åè°ƒç”¨thread-&amp;gt;exit(true) æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æŠŠçº¿ç¨‹ä»active listå¸ä¸‹ï¼Œåˆ é™¤çº¿ç¨‹ç­‰ç­‰ä¸€ç³»åˆ—å·¥ä½œæ‰§è¡Œå®Œæˆåï¼Œåˆ™é€šçŸ¥æ­£åœ¨ç­‰å¾…çš„DestroyJavaVM çº¿ç¨‹æ‰§è¡Œå¸è½½JVMæ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ContainerBackgroundProcessor çº¿ç¨‹&lt;/p&gt;

&lt;p&gt;JBOSS&lt;/p&gt;

&lt;p&gt;å®ƒæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹, åœ¨jbossæœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™å°±åˆå§‹åŒ–äº†,ä¸»è¦å·¥ä½œæ˜¯å®šæœŸå»æ£€æŸ¥æœ‰æ²¡æœ‰Sessionè¿‡æœŸ.è¿‡æœŸåˆ™æ¸…é™¤.&lt;/p&gt;

&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://liudeh-009.iteye.com/blog/1584876&#34;&gt;http://liudeh-009.iteye.com/blog/1584876&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Dispatcher-Thread-3  çº¿ç¨‹&lt;/p&gt;

&lt;p&gt;Log4j&lt;/p&gt;

&lt;p&gt;Log4jå…·æœ‰å¼‚æ­¥æ‰“å°æ—¥å¿—çš„åŠŸèƒ½ï¼Œéœ€è¦å¼‚æ­¥æ‰“å°æ—¥å¿—çš„Appenderéƒ½éœ€è¦æ³¨å†Œåˆ° AsyncAppenderå¯¹è±¡é‡Œé¢å»ï¼Œç”±AsyncAppenderè¿›è¡Œç›‘å¬ï¼Œå†³å®šä½•æ—¶è§¦å‘æ—¥å¿—æ‰“å°æ“ä½œã€‚ AsyncAppenderå¦‚æœç›‘å¬åˆ°å®ƒç®¡è¾–èŒƒå›´å†…çš„Appenderæœ‰æ‰“å°æ—¥å¿—çš„æ“ä½œï¼Œåˆ™ç»™è¿™ä¸ªAppenderç”Ÿæˆä¸€ä¸ªç›¸åº”çš„eventï¼Œå¹¶å°†è¯¥eventä¿å­˜åœ¨ä¸€ä¸ªbuffueråŒºåŸŸå†…ã€‚&lt;/p&gt;

&lt;p&gt;Dispatcher-Thread-3çº¿ç¨‹è´Ÿè´£åˆ¤æ–­è¿™ä¸ªeventç¼“å­˜åŒºæ˜¯å¦å·²ç»æ»¡äº†ï¼Œå¦‚æœå·²ç»æ»¡äº†ï¼Œåˆ™å°†ç¼“å­˜åŒºå†…çš„æ‰€æœ‰eventåˆ†å‘åˆ°Appenderå®¹å™¨é‡Œé¢å»ï¼Œé‚£äº›æ³¨å†Œä¸Šæ¥çš„Appenderæ”¶åˆ°è‡ªå·±çš„eventåï¼Œåˆ™å¼€å§‹å¤„ç†è‡ªå·±çš„æ—¥å¿—æ‰“å°å·¥ä½œã€‚ Dispatcher-Thread-3çº¿ç¨‹æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;Finalizerçº¿ç¨‹&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨mainçº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼›å…³äºFinalizerçº¿ç¨‹çš„å‡ ç‚¹ï¼š&lt;/p&gt;

&lt;p&gt;1) åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼›&lt;/p&gt;

&lt;p&gt;2) è¯¥çº¿ç¨‹ä¹Ÿæ˜¯daemonçº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–édaemonçº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œfinalize()æ–¹æ³•ï¼ŒJVMä¹Ÿä¼šé€€å‡ºï¼›&lt;/p&gt;

&lt;p&gt;3) JVMåœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆFinalizerå¯¹è±¡ï¼ˆReferenceçš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ReferenceQueueï¼Œç”±Finalizerçº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥Finalizerå¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼›&lt;/p&gt;

&lt;p&gt;4) JVMä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œfinalize()æ–¹æ³•å‘¢ï¼Ÿå¦‚æœJVMçš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´GCçº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹GCçº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ï¼›&lt;/p&gt;

&lt;p&gt;Gang worker#0&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;JVM ç”¨äºåšæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼ˆmonir gcï¼‰çš„ä¸€ä¸ªçº¿ç¨‹ã€‚#å·åé¢æ˜¯çº¿ç¨‹ç¼–å·ï¼Œä¾‹å¦‚ï¼šGang worker#1&lt;/p&gt;

&lt;p&gt;GC Daemon&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;GC Daemon çº¿ç¨‹æ˜¯JVMä¸ºRMIæä¾›è¿œç¨‹åˆ†å¸ƒå¼GCä½¿ç”¨çš„ï¼ŒGC Daemonçº¿ç¨‹é‡Œé¢ä¼šä¸»åŠ¨è°ƒç”¨System.gc()æ–¹æ³•ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡ŒFull GCã€‚ å…¶åˆè¡·æ˜¯å½“ RMI æœåŠ¡å™¨è¿”å›ä¸€ä¸ªå¯¹è±¡åˆ°å…¶å®¢æˆ·æœºï¼ˆè¿œç¨‹æ–¹æ³•çš„è°ƒç”¨æ–¹ï¼‰æ—¶ï¼Œå…¶è·Ÿè¸ªè¿œç¨‹å¯¹è±¡åœ¨å®¢æˆ·æœºä¸­çš„ä½¿ç”¨ã€‚å½“å†æ²¡æœ‰æ›´å¤šçš„å¯¹å®¢æˆ·æœºä¸Šè¿œç¨‹å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œæˆ–è€…å¦‚æœå¼•ç”¨çš„â€œç§Ÿå€Ÿâ€è¿‡æœŸå¹¶ä¸”æ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨å°†åƒåœ¾å›æ”¶è¿œç¨‹å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ï¼Œæˆ‘ä»¬ç°åœ¨jvmå¯åŠ¨å‚æ•°éƒ½åŠ ä¸Šäº†-XX:+DisableExplicitGCé…ç½®ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªçº¿ç¨‹åªæœ‰æ‰“é…±æ²¹çš„ä»½äº†ã€‚&lt;/p&gt;

&lt;p&gt;IdleRemover&lt;/p&gt;

&lt;p&gt;JBOSS&lt;/p&gt;

&lt;p&gt;Jbossè¿æ¥æ± æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼Œ è¯¥çº¿ç¨‹æ¯è¿‡ä¸€æ®µæ—¶é—´éƒ½ä¼šè¢«Jbosså”¤èµ·ï¼Œç”¨äºæ£€æŸ¥å’Œé”€æ¯è¿æ¥æ± ä¸­ç©ºé—²å’Œæ— æ•ˆçš„è¿æ¥ï¼Œç›´åˆ°å‰©ä½™çš„è¿æ¥æ•°å°äºç­‰äºå®ƒçš„æœ€å°å€¼ã€‚&lt;/p&gt;

&lt;p&gt;Java2D Disposer&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªçº¿ç¨‹ä¸»è¦æœåŠ¡äºawtçš„å„ä¸ªç»„ä»¶ã€‚ è¯´èµ·è¯¥çº¿ç¨‹çš„ä¸»è¦å·¥ä½œèŒè´£å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹Disposerç±»æ˜¯å¹²å˜›çš„ã€‚ Disposeræä¾›ä¸€ä¸ªaddRecordæ–¹æ³•ã€‚ å¦‚æœä½ æƒ³åœ¨ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯å‰å†åšä¸€äº›å–„åå·¥ä½œï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥è°ƒç”¨Disposer#addRecordæ–¹æ³•ï¼Œå°†è¿™ä¸ªå¯¹è±¡å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„DisposerRecordæ¥å£å®ç°ç±»ï¼Œä¸€èµ·ä¼ å…¥è¿›å»ï¼Œè¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;

&lt;p&gt;Disposerç±»ä¼šå”¤èµ·â€œJava2D Disposerâ€çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šæ‰«æå·²æ³¨å†Œçš„è¿™äº›å¯¹è±¡æ˜¯å¦è¦è¢«å›æ”¶äº†ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨è¯¥å¯¹è±¡å¯¹åº”çš„DisposerRecordå®ç°ç±»é‡Œé¢çš„disposeæ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;Disposerå®é™…ä¸Šä¸é™äºåœ¨awtåº”ç”¨åœºæ™¯ï¼Œåªæ˜¯awté‡Œé¢çš„å¾ˆå¤šç»„ä»¶éœ€è¦è®¿é—®å¾ˆå¤šæ“ä½œç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ï¼Œè¿™äº›ç»„ä»¶åœ¨è¢«å›æ”¶æ—¶ï¼Œéœ€è¦å…ˆé‡Šæ”¾è¿™äº›èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;InsttoolCacheScheduler_QuartzSchedulerThread&lt;/p&gt;

&lt;p&gt;Quartz&lt;/p&gt;

&lt;p&gt;InsttoolCacheScheduler_QuartzSchedulerThreadæ˜¯Quartzçš„ä¸»çº¿ç¨‹ï¼Œå®ƒä¸»è¦è´Ÿè´£å®æ—¶çš„è·å–ä¸‹ä¸€ä¸ªæ—¶é—´ç‚¹è¦è§¦å‘çš„è§¦å‘å™¨ï¼Œç„¶åæ‰§è¡Œè§¦å‘å™¨ç›¸å…³è”çš„ä½œä¸š ã€‚&lt;/p&gt;

&lt;p&gt;åŸç†å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;Springå’ŒQuartzç»“åˆä½¿ç”¨çš„åœºæ™¯ä¸‹ï¼ŒSpring IOCå®¹å™¨åˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºå¹¶åˆå§‹åŒ–Quartzçº¿ç¨‹æ± ï¼ˆTreadPoolï¼‰ï¼Œå¹¶å¯åŠ¨å®ƒã€‚åˆšå¯åŠ¨æ—¶çº¿ç¨‹æ± ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å¤–ç•Œç»™ä»–åˆ†é…Runnableï¼ˆæŒæœ‰ä½œä¸šå¯¹è±¡çš„çº¿ç¨‹ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ç»§è€Œæ¥ç€åˆå§‹åŒ–å¹¶å¯åŠ¨Quartzçš„ä¸»çº¿ç¨‹&lt;/p&gt;

&lt;p&gt;ï¼ˆInsttoolCacheScheduler_QuartzSchedulerThreadï¼‰ï¼Œè¯¥çº¿ç¨‹è‡ªå¯åŠ¨åå°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ã€‚ç­‰å¾…å¤–ç•Œç»™å‡ºå·¥ä½œä¿¡å·ä¹‹åï¼Œè¯¥ä¸»çº¿ç¨‹çš„runæ–¹æ³•æ‰å®è´¨ä¸Šå¼€å§‹å·¥ä½œã€‚runä¸­ä¼šè·å–JobStoreä¸­ä¸‹ä¸€æ¬¡è¦è§¦å‘çš„ä½œä¸šï¼Œæ‹¿åˆ°ä¹‹åä¼šä¸€ç›´ç­‰å¾…åˆ°è¯¥ä½œä¸šçš„çœŸæ­£è§¦å‘æ—¶é—´ï¼Œç„¶åå°†è¯¥ä½œä¸šåŒ…è£…æˆä¸€ä¸ªJobRunShellå¯¹è±¡ï¼ˆè¯¥å¯¹è±¡å®ç°äº†Runnableæ¥å£ï¼Œå…¶å®çœ‹æ˜¯ä¸Šé¢TreadPoolä¸­ç­‰å¾…å¤–ç•Œåˆ†é…ç»™ä»–çš„Runnableï¼‰ï¼Œç„¶åå°†åˆšåˆ›å»ºçš„JobRunShelläº¤ç»™çº¿ç¨‹æ± ï¼Œç”±çº¿ç¨‹æ± è´Ÿè´£æ‰§è¡Œä½œä¸šã€‚&lt;/p&gt;

&lt;p&gt;çº¿ç¨‹æ± æ”¶åˆ°Runnableåï¼Œä»çº¿ç¨‹æ± ä¸€ä¸ªçº¿ç¨‹å¯åŠ¨Runnableï¼Œåå°„è°ƒç”¨JobRunShellä¸­çš„runæ–¹æ³•ï¼Œrunæ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åï¼Œ TreadPoolå°†è¯¥çº¿ç¨‹å›æ”¶è‡³ç©ºé—²çº¿ç¨‹ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;InsttoolCacheScheduler_Worker-2&lt;/p&gt;

&lt;p&gt;Quartz&lt;/p&gt;

&lt;p&gt;InsttoolCacheScheduler_Worker-2çº¿ç¨‹å°±æ˜¯ThreadPoolçº¿ç¨‹çš„ä¸€ä¸ªç®€å•å®ç°ï¼Œå®ƒä¸»è¦è´Ÿè´£åˆ†é…çº¿ç¨‹èµ„æºå»æ‰§è¡Œ&lt;/p&gt;

&lt;p&gt;InsttoolCacheScheduler_QuartzSchedulerThreadçº¿ç¨‹äº¤ç»™å®ƒçš„è°ƒåº¦ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯JobRunShellï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;JBossLifeThread&lt;/p&gt;

&lt;p&gt;Jboss&lt;/p&gt;

&lt;p&gt;Jbossä¸»çº¿ç¨‹å¯åŠ¨æˆåŠŸï¼Œåº”ç”¨ç¨‹åºéƒ¨ç½²å®Œæ¯•ä¹‹åå°†JBossLifeThreadçº¿ç¨‹å®ä¾‹åŒ–å¹¶ä¸”startï¼ŒJBossLifeThreadçº¿ç¨‹å¯åŠ¨æˆåŠŸä¹‹åå°±å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä»¥ä¿æŒJboss Javaè¿›ç¨‹å¤„äºå­˜æ´»ä¸­ã€‚  æ‰€å¾—æ¯”è¾ƒé€šä¿—ä¸€ç‚¹ï¼Œå°±æ˜¯Jbosså¯åŠ¨æµç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç»“æŸï¼Ÿ å°±æ˜¯å› ä¸ºæœ‰è¿™ä¸ªçº¿ç¨‹holdä¸»äº†å®ƒã€‚&lt;/p&gt;

&lt;p&gt;JBoss System Threads(1)-1&lt;/p&gt;

&lt;p&gt;Jboss&lt;/p&gt;

&lt;p&gt;è¯¥çº¿ç¨‹æ˜¯ä¸€ä¸ªsocketæœåŠ¡ï¼Œé»˜è®¤ç«¯å£å·ä¸ºï¼š 1099ã€‚&lt;/p&gt;

&lt;p&gt;ä¸»è¦ç”¨äºæ¥æ”¶å¤–éƒ¨naming serviceï¼ˆJboss  JNDIï¼‰è¯·æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;JCA PoolFiller&lt;/p&gt;

&lt;p&gt;Jboss&lt;/p&gt;

&lt;p&gt;è¯¥çº¿ç¨‹ä¸»è¦ä¸ºJBosså†…éƒ¨æä¾›è¿æ¥æ± çš„æ‰˜ç®¡ã€‚&lt;/p&gt;

&lt;p&gt;ç®€å•ä»‹ç»ä¸€ä¸‹å·¥ä½œåŸç† ï¼š&lt;/p&gt;

&lt;p&gt;Jbosså†…éƒ¨å‡¡æ˜¯æœ‰è¿œç¨‹è¿æ¥éœ€æ±‚çš„ç±»ï¼Œéƒ½éœ€è¦å®ç°&lt;/p&gt;

&lt;p&gt;ManagedConnectionFactoryæ¥å£ï¼Œä¾‹å¦‚éœ€è¦åšJDBCè¿æ¥çš„&lt;/p&gt;

&lt;p&gt;XAManagedConnectionFactoryå¯¹è±¡ï¼Œå°±å®ç°äº†è¯¥æ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åå°†XAManagedConnectionFactoryå¯¹è±¡ï¼Œ&lt;/p&gt;

&lt;p&gt;è¿˜æœ‰å…¶å®ƒä¿¡æ¯ä¸€èµ·åŒ…è£…åˆ°&lt;/p&gt;

&lt;p&gt;InternalManagedConnectionPool&lt;/p&gt;

&lt;p&gt;å¯¹è±¡é‡Œé¢ï¼Œæ¥ç€å°†&lt;/p&gt;

&lt;p&gt;InternalManagedConnectionPool&lt;/p&gt;

&lt;p&gt;äº¤ç»™PoolFillerå¯¹è±¡é‡Œé¢çš„åˆ—é˜Ÿè¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;

&lt;p&gt;JCA PoolFillerçº¿ç¨‹ä¼šå®šæœŸåˆ¤æ–­åˆ—é˜Ÿå†…æ˜¯å¦æœ‰éœ€è¦åˆ›å»ºå’Œç®¡ç†çš„&lt;/p&gt;

&lt;p&gt;InternalManagedConnectionPool&lt;/p&gt;

&lt;p&gt;å¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œåˆ™è°ƒç”¨è¯¥å¯¹è±¡çš„fillToMinæ–¹æ³•ï¼Œ è§¦å‘å®ƒå»åˆ›å»ºç›¸åº”çš„è¿œç¨‹è¿æ¥ï¼Œå¹¶ä¸”å°†è¿™ä¸ªè¿æ¥ç»´æŠ¤åˆ°å®ƒç›¸åº”çš„è¿æ¥æ± é‡Œé¢å»ã€‚&lt;/p&gt;

&lt;p&gt;JDWP Event Helper Thread&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;JDWPæ˜¯é€šè®¯äº¤äº’åè®®ï¼Œå®ƒå®šä¹‰äº†è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•ç¨‹åºä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ ¼å¼ã€‚å®ƒè¯¦ç»†å®Œæ•´åœ°å®šä¹‰äº†è¯·æ±‚å‘½ä»¤ã€å›åº”æ•°æ®å’Œé”™è¯¯ä»£ç ï¼Œä¿è¯äº†å‰ç«¯å’Œåç«¯çš„JVMTIå’ŒJDIçš„é€šä¿¡é€šç•…ã€‚  è¯¥çº¿ç¨‹ä¸»è¦è´Ÿè´£å°†JDIäº‹ä»¶æ˜ å°„æˆJVMTIä¿¡å·ï¼Œä»¥è¾¾åˆ°è°ƒè¯•è¿‡ç¨‹ä¸­æ“ä½œJVMçš„ç›®çš„ã€‚&lt;/p&gt;

&lt;p&gt;JDWP Transport Listener:&lt;/p&gt;

&lt;p&gt;dt_socket&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¯¥çº¿ç¨‹æ˜¯ä¸€ä¸ªJava Debuggerçš„ç›‘å¬å™¨çº¿ç¨‹ï¼Œè´Ÿè´£å—ç†å®¢æˆ·ç«¯çš„debugè¯·æ±‚ã€‚ é€šå¸¸æˆ‘ä»¬ä¹ æƒ¯å°†å®ƒçš„ç›‘å¬ç«¯å£è®¾ç½®ä¸º8787ã€‚&lt;/p&gt;

&lt;p&gt;Low Memory Detector&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªçº¿ç¨‹æ˜¯è´Ÿè´£å¯¹å¯ä½¿ç”¨å†…å­˜è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå‘ç°å¯ç”¨å†…å­˜ä½ï¼Œåˆ†é…æ–°çš„å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;

&lt;p&gt;process reaper&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¯¥çº¿ç¨‹è´Ÿè´£å»æ‰§è¡Œä¸€ä¸ª OS å‘½ä»¤è¡Œçš„æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;Reference Handler&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;JVMåœ¨åˆ›å»ºmainçº¿ç¨‹åå°±åˆ›å»ºReference Handlerçº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ ã€‚&lt;/p&gt;

&lt;p&gt;Surrogate Locker Thread (CMS)&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªçº¿ç¨‹ä¸»è¦ç”¨äºé…åˆCMSåƒåœ¾å›æ”¶å™¨ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå…¶ä¸»è¦è´Ÿè´£å¤„ç†GCè¿‡ç¨‹ä¸­ï¼ŒJavaå±‚çš„Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸jvm å†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚ è¿™é‡Œå¯¹å®ƒä»¬çš„å®ç°ç¨å¾®åšä¸€ä¸‹ä»‹ç»ï¼šè¿™é‡Œæ‹¿ WeakHashMapåšä¾‹å­ï¼Œå°†ä¸€äº›å…³é”®ç‚¹å…ˆåˆ—å‡ºæ¥ï¼ˆæˆ‘ä»¬åé¢ä¼šå°†è¿™äº›å…³é”®ç‚¹å…¨éƒ¨ä¸²èµ·æ¥ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;1.æˆ‘ä»¬çŸ¥é“HashMapç”¨Entry[]æ•°ç»„æ¥å­˜å‚¨æ•°æ®çš„ï¼ŒWeakHashMapä¹Ÿä¸ä¾‹å¤–, å†…éƒ¨æœ‰ä¸€ä¸ªEntry[]æ•°ç»„ã€‚&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;WeakHashMapçš„Entryæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æ„ä¸º&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Entry-&amp;gt;WeakReference-&amp;gt;Reference ã€‚&lt;/p&gt;

&lt;p&gt;3.Reference é‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œ&lt;/p&gt;

&lt;p&gt;å®ƒä¹Ÿè¢«ç§°ä¸ºpending_lock.æ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ã€‚&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Reference  é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Referenceé‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandlerçš„çº¿ç¨‹ï¼Œå®ƒåœ¨staticå—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®Œæˆåå¤„äºwaitçŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ªLockåŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;6.å¦å¤–ï¼ŒWeakHashMapé‡Œé¢è¿˜å®ä¾‹åŒ–äº†ä¸€ä¸ªReferenceQueueåˆ—é˜Ÿï¼Œè¿™ä¸ªåˆ—é˜Ÿçš„ä½œç”¨ï¼Œåé¢ä¼šæåˆ°ã€‚&lt;/p&gt;

&lt;p&gt;7.ä¸Šé¢å…³é”®ç‚¹å°±ä»‹ç»å®Œæ¯•äº†ï¼Œä¸‹é¢æˆ‘ä»¬æŠŠä»–ä»¬ä¸²èµ·æ¥ã€‚&lt;/p&gt;

&lt;p&gt;å‡è®¾ï¼ŒWeakHashMapå¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;JVM åœ¨è¿›è¡ŒCMS GCçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªConcurrentMarkSweepThreadï¼ˆç®€ç§°CMSTï¼‰çº¿ç¨‹å»è¿›è¡ŒGCï¼ŒConcurrentMarkSweepThreadçº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªSurrogateLockerThreadï¼ˆç®€ç§°SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLTå¯åŠ¨ä¹‹åï¼Œå¤„äºç­‰å¾…é˜¶æ®µã€‚CMSTå¼€å§‹GCæ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™SLTè®©å®ƒå»è·å–Javaå±‚Referenceå¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ ç›´åˆ°CMS GCå®Œæ¯•ä¹‹åï¼ŒJVM ä¼šå°†WeakHashMapä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„WeakReferenceå®¹å™¨å¯¹è±¡æ”¾å…¥åˆ°Reference çš„pendingå±æ€§å½“ä¸­ï¼ˆæ¯æ¬¡GCå®Œæ¯•ä¹‹åï¼Œpendingå±æ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸ºnulläº†ï¼‰ï¼Œç„¶åé€šçŸ¥SLTé‡Šæ”¾å¹¶ä¸”notifyå…¨å±€é”:Lockã€‚æ­¤æ—¶æ¿€æ´»äº†ReferenceHandlerçº¿ç¨‹çš„runæ–¹æ³•ï¼Œä½¿å…¶è„±ç¦»waitçŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚ReferenceHandlerè¿™ä¸ªçº¿ç¨‹ä¼šå°†pendingä¸­çš„æ‰€æœ‰WeakReferenceå¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ªWeakReferenceå±äºæŸä¸ªWeakHashMapå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ReferenceQueueåˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ã€‚ å½“æˆ‘ä»¬ä¸‹æ¬¡ä»WeakHashMapå¯¹è±¡é‡Œé¢getã€putæ•°æ®æˆ–è€…è°ƒç”¨sizeæ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMapå°±ä¼šå°†ReferenceQueueåˆ—é˜Ÿä¸­çš„WeakReferenceä¾ä¾pollå‡ºæ¥å»å’ŒEntry[]æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜è¿™ä¸ªEntryæ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢«GCæ‰äº†ï¼Œé‚£ä¹ˆå°†Entry[]å†…çš„Entryå¯¹è±¡å‰”é™¤æ‰ã€‚&lt;/p&gt;

&lt;p&gt;taskObjectTimerFactory&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„ã€‚ å½“æˆ‘ä»¬æŠŠä¸€ä¸ªè®¤ä¸ºäº¤ç»™Timerå¯¹è±¡ï¼Œå¹¶ä¸”å‘Šè¯‰å®ƒæ‰§è¡Œæ—¶é—´ï¼Œå‘¨æœŸæ—¶é—´åï¼ŒTimerå°±ä¼šå°†è¯¥ä»»åŠ¡æ”¾å…¥ä»»åŠ¡åˆ—é˜Ÿï¼Œå¹¶ä¸”é€šçŸ¥taskObjectTimerFactoryçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼ŒtaskObjectTimerFactoryçº¿ç¨‹ä¼šå°†çŠ¶æ€ä¸ºå–æ¶ˆçš„ä»»åŠ¡ä»ä»»åŠ¡åˆ—é˜Ÿä¸­ç§»é™¤ï¼Œå¦‚æœä»»åŠ¡æ˜¯éé‡å¤æ‰§è¡Œç±»å‹çš„ï¼Œåˆ™åœ¨æ‰§è¡Œå®Œè¯¥ä»»åŠ¡åï¼Œå°†å®ƒä»ä»»åŠ¡åˆ—é˜Ÿä¸­ç§»é™¤ï¼Œå¦‚æœè¯¥ä»»åŠ¡æ˜¯éœ€è¦é‡å¤æ‰§è¡Œçš„ï¼Œåˆ™è®¡ç®—å‡ºå®ƒä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;VM Periodic Task Thread&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¯¥çº¿ç¨‹æ˜¯JVMå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”±WatcherThreadåˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚ è¯¥çº¿ç¨‹åœ¨JVMå†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æ§ã€JVMè¿è¡ŒçŠ¶å†µç›‘æ§ï¼Œè¿˜æœ‰æˆ‘ä»¬ç»å¸¸éœ€è¦å»æ‰§è¡Œä¸€äº›jstat è¿™ç±»å‘½ä»¤æŸ¥çœ‹gcçš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;jstat -gcutil 23483 250 7   è¿™ä¸ªå‘½ä»¤å‘Šè¯‰jvmåœ¨æ§åˆ¶å°æ‰“å°PIDä¸ºï¼š23483çš„gcæƒ…å†µï¼Œé—´éš”250æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œä¸€å…±æ‰“å°7æ¬¡ã€‚&lt;/p&gt;

&lt;p&gt;VM Thread&lt;/p&gt;

&lt;p&gt;JVM&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªçº¿ç¨‹å°±æ¯”è¾ƒç‰›bäº†ï¼Œæ˜¯jvmé‡Œé¢çš„çº¿ç¨‹æ¯ä½“ï¼Œæ ¹æ®hotspotæºç ï¼ˆvmThread.hppï¼‰é‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¸ªçš„VMçº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº›VMæ“ä½œï¼ˆå¦‚ï¼Œæ¸…æ‰«åƒåœ¾ç­‰ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ VMThread çš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªVMOperationQueueåˆ—é˜Ÿï¼Œæ‰€æœ‰çš„VMçº¿ç¨‹æ“ä½œ(vm_operation)éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThread æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„loopå‡½æ•°(å…·ä½“å¯ä»¥å‚è€ƒï¼š&lt;/p&gt;

&lt;p&gt;VMThread.cppé‡Œé¢çš„&lt;/p&gt;

&lt;p&gt;void VMThread::loop()) ï¼Œè¯¥loopå‡½æ•°ä»VMOperationQueueåˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡(VM_Operation)ï¼Œ&lt;/p&gt;

&lt;p&gt;å¹¶ä¸”è°ƒç”¨VM_Operation-&amp;gt;evaluateå‡½æ•°å»æ‰§è¡Œè¯¥æ“ä½œç±»å‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;

&lt;p&gt;psï¼šVMæ“ä½œç±»å‹è¢«å®šä¹‰åœ¨&lt;/p&gt;

&lt;p&gt;vm_operations.hppæ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€&lt;/p&gt;

&lt;p&gt;ThreadDumpã€&lt;/p&gt;

&lt;p&gt;PrintThreadsã€&lt;/p&gt;

&lt;p&gt;GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦..&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>